<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Devolu√ß√£o</title>
    <link rel="icon" type="image/png" href="../image/zenirlogo.png">
    <link rel="stylesheet" href="../css/declaracoes.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Header Modernizado -->
    <header class="header">
        <div class="container-header">
            <button class="btn-voltar" id="btnVoltar">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Voltar
            </button>
            
            <h1 class="header-title">Declara√ß√£o de Devolu√ß√£o</h1>

            <!-- Container dos Bot√µes e Progresso -->
            <div class="header-right" id="headerRight">
                <!-- Bot√µes de A√ß√£o Minimalistas -->
                <div class="header-actions">
                    <button class="btn-action-icon" id="btnLimparHeader" title="Limpar Campos">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        <span class="btn-action-label">Limpar</span>
                    </button>
                    
                    <button class="btn-action-icon" id="btnGerarPDFHeader" title="Gerar PDF">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        <span class="btn-action-label">Gerar PDF</span>
                    </button>

                    <button class="btn-action-icon" id="btnFecharHeader" title="Fechar Formul√°rio">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        <span class="btn-action-label">Fechar</span>
                    </button>
                </div>

                <!-- Barra de Progresso Compacta -->
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar-wrapper">
                        <div class="progress-bar-fill" id="progressBarFill"></div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard -->
    <div class="dashboard">
        <!-- √çcones Flutuantes -->
        <div class="icones-flutuantes" id="iconesFlutuantes">
            <div class="icone-flutuante" style="top: 15%; left: 15%;">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                    <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
            </div>
            
            <div class="icone-flutuante" style="top: 60%; left: 20%;">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                </svg>
            </div>
            
            <div class="icone-flutuante" style="top: 20%; right: 20%;">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
            </div>
            
            <div class="icone-flutuante" style="top: 65%; right: 15%;">
                <img src="../image/zenirlogo.png" width="60" alt="Logo">
            </div>
        </div>

        <!-- Bot√£o Central -->
        <div class="botao-central" id="botaoCentral">
            <!-- Boas-vindas -->
            <div class="welcome-message">
                <h1 class="welcome-title">üëã Ol√°, <span class="welcome-name" id="userName">Usu√°rio</span>!</h1>
                <p class="welcome-subtitle">Bem-vindo ao Sistema de Declara√ß√£o de Devolu√ß√£o</p>
            </div>

            <button class="botao-abrir-form" id="btnAbrirFormulario">
                <div class="botao-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </div>
                <span class="botao-text">Abrir Formul√°rio</span>
            </button>
        </div>

        <!-- Formul√°rio -->
        <div class="formulario-layout" id="formularioLayout">
            <main class="formulario-container-full">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Declara√ß√£o de Devolu√ß√£o</h2>
                    </div>
                    
                    <form id="formularioDeclaracao">
                        <!-- NF-e | Nome | CPF | Filial -->
                        <div class="form-row form-row-4">
                            <div class="form-group">
                                <label for="numeroNFe">NF-e de Devolu√ß√£o</label>
                                <input type="text" id="numeroNFe" placeholder="N¬∫ NF-e">
                            </div>
                            <div class="form-group">
                                <label for="nomeCliente">Nome do Cliente <span class="obrigatorio">*</span></label>
                                <input type="text" id="nomeCliente" placeholder="Nome completo">
                            </div>
                            <div class="form-group">
                                <label for="cpf">CPF <span class="obrigatorio">*</span></label>
                                <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14">
                            </div>
                            <div class="form-group">
                                <label for="filial">Filial <span class="obrigatorio">*</span></label>
                                <select id="filial">
                                    <option value="">Selecione</option>
                                    <option value="02">Filial 02 - Iguatu II</option>
                                    <option value="04">Filial 04 - Quixad√°</option>
                                    <option value="05">Filial 05 - Brejo Santo</option>
                                    <option value="06">Filial 06 - Crato</option>
                                    <option value="07">Filial 07 - Momba√ßa</option>
                                    <option value="09">Filial 09 - Juazeiro I</option>
                                    <option value="13">Filial 13 - Campos Sales</option>
                                    <option value="14">Filial 14 - Tiangu√° II</option>
                                    <option value="16">Filial 16 - General II</option>
                                    <option value="17">Filial 17 - General</option>
                                    <option value="21">Filial 21 - Crate√∫s</option>
                                    <option value="23">Filial 23 - Senador II</option>
                                    <option value="24">Filial 24 - Acopiara</option>
                                    <option value="25">Filial 25 - Maracana√∫</option>
                                    <option value="27">Filial 27 - Itapipoca</option>
                                    <option value="28">Filial 28 - Iguatu III</option>
                                    <option value="29">Filial 29 - V√°rzea Alegre</option>
                                    <option value="30">Filial 30 - Assar√©</option>
                                    <option value="31">Filial 31 - Sobral II</option>
                                    <option value="32">Filial 32 - Juazeiro II</option>
                                    <option value="34">Filial 34 - Ubajara</option>
                                    <option value="35">Filial 35 - Cedro</option>
                                    <option value="36">Filial 36 - Ic√≥</option>
                                    <option value="37">Filial 37 - Parambu</option>
                                    <option value="38">Filial 38 - Tabuleiro</option>
                                    <option value="39">Filial 39 - Tau√°</option>
                                    <option value="40">Filial 40 - Montese</option>
                                    <option value="41">Filial 41 - Horizonte</option>
                                    <option value="42">Filial 42 - Limoeiro</option>
                                    <option value="43">Filial 43 - Morada Nova</option>
                                    <option value="45">Filial 45 - Maranguape</option>
                                    <option value="46">Filial 46 - Miss√£o Velha</option>
                                    <option value="47">Filial 47 - Pacajus</option>
                                    <option value="48">Filial 48 - Sobral III</option>
                                    <option value="49">Filial 49 - Guaraciaba</option>
                                    <option value="51">Filial 51 - Quixel√¥</option>
                                    <option value="52">Filial 52 - Mauriti</option>
                                    <option value="53">Filial 53 - Maracana√∫ II</option>
                                    <option value="54">Filial 54 - Barbalha</option>
                                    <option value="55">Filial 55 - Aracati</option>
                                    <option value="56">Filial 56 - Messejana I</option>
                                    <option value="57">Filial 57 - Kennedy</option>
                                    <option value="58">Filial 58 - Papicu</option>
                                    <option value="59">Filial 59 - Senador Pompeu</option>
                                    <option value="60">Filial 60 - Pedra Branca</option>
                                    <option value="61">Filial 61 - Caucaia II</option>
                                    <option value="63">Filial 63 - Sobral IV</option>
                                    <option value="65">Filial 65 - Senador IV</option>
                                    <option value="66">Filial 66 - Iguatemi</option>
                                    <option value="67">Filial 67 - Eus√©bio</option>
                                    <option value="68">Filial 68 - Messejana II</option>
                                    <option value="69">Filial 69 - Massap√™</option>
                                    <option value="70">Filial 70 - S√£o Benedito</option>
                                    <option value="71">Filial 71 - Cascavel</option>
                                    <option value="72">Filial 72 - Floriano Peixoto</option>
                                    <option value="73">Filial 73 - Aquiraz</option>
                                    <option value="74">Filial 74 - Del Paseo</option>
                                    <option value="75">Filial 75 - Juc√°s</option>
                                    <option value="76">Filial 76 - Trairi</option>
                                    <option value="77">Filial 77 - Camocim</option>
                                </select>
                            </div>
                        </div>

                        <!-- Produtos -->
                        <div class="form-section">
                            <h3>Produtos <span class="obrigatorio">*</span> <small>(Preencha ao menos 1 produto completo)</small></h3>
                            <div id="listaProdutos"></div>
                        </div>

                        <!-- Endere√ßo com busca autom√°tica | Bairro | N√∫mero | Cidade | UF -->
                        <div class="form-row form-row-5">
                            <div class="form-group">
                                <label for="endereco">Endere√ßo <span class="obrigatorio">*</span></label>
                                <div class="input-with-loader">
                                    <input type="text" id="endereco" placeholder="CEP ou Endere√ßo">
                                    <div class="input-loader" id="enderecoLoader">
                                        <div class="loader-spinner"></div>
                                    </div>
                                </div>
                                <small class="field-hint" id="enderecoHint"> </small>
                            </div>
                            <div class="form-group">
                                <label for="bairro">Bairro</label>
                                <input type="text" id="bairro" placeholder="Bairro">
                            </div>
                            <div class="form-group">
                                <label for="numero">N√∫mero</label>
                                <input type="text" id="numero" placeholder="N¬∫">
                            </div>
                            <div class="form-group">
                                <label for="cidade">Cidade</label>
                                <input type="text" id="cidade" placeholder="Cidade">
                            </div>
                            <div class="form-group">
                                <label for="estado">UF</label>
                                <input type="text" id="estado" placeholder="UF" maxlength="2">
                            </div>
                        </div>

                        <!-- PV | Cupom | Nova Compra | Novo PV -->
                        <div class="form-row form-row-4">
                            <div class="form-group">
                                <label for="pv">PV <span class="obrigatorio">*</span></label>
                                <input type="text" id="pv" placeholder="PV">
                            </div>
                            <div class="form-group">
                                <label for="cupomNFe">Cupom/NF-e/NFC-e <span class="obrigatorio">*</span></label>
                                <input type="text" id="cupomNFe" placeholder="Cupom/NF-e/NFC-e">
                            </div>
                            <div class="form-group">
                                <label for="outraCompra">Cliente efetuou nova compra?</label>
                                <select id="outraCompra">
                                    <option value="">Selecione</option>
                                    <option value="Sim">Sim</option>
                                    <option value="N√£o">N√£o</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="novoPV">Novo PV</label>
                                <input type="text" id="novoPV" placeholder="Novo PV" disabled>
                            </div>
                        </div>

                        <!-- Motivo -->
                        <div class="form-section">
                            <div class="form-group">
                                <label for="motivoDevolucao">Motivo da Devolu√ß√£o <span class="obrigatorio">*</span></label>
                                <textarea id="motivoDevolucao" rows="3" placeholder="Descreva o motivo da devolu√ß√£o"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="modalConfirmacao" class="modal">
        <div class="modal-content modal-confirmacao">
            <div class="modal-icon warning">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            <h3 id="modalTitulo">Confirmar a√ß√£o?</h3>
            <p id="modalMensagem">Mensagem de confirma√ß√£o</p>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelar">Cancelar</button>
                <button class="btn-danger" id="btnConfirmar">Confirmar</button>
            </div>
        </div>
    </div>


    <div id="overlayBuscaProduto" class="overlay-loading">
        <div class="modern-loader">
            <div class="loader-icon">
                <div class="loader-lupa"></div>
            </div>
            <h3 class="loader-title">Buscando produto...</h3>
        </div>
    </div>


    <div id="overlayLoading" class="overlay-loading">
        <div class="modern-loader">
            <div class="loader-icon">
                <div class="loader-seta"></div>
            </div>
            <h3 class="loader-title" id="loadingText">Gerando PDF...</h3>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="../js/declaracoes.js"></script>
    <script src="../js/session-guard.js"></script>
</body>
</html>